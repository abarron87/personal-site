"use strict";var app=angular.module("treeApp",[]).config(["$interpolateProvider",function(a){a.startSymbol("[["),a.endSymbol("]]")}]);app.controller("AutoSuggestController",["$scope","categoriesMapBuilder","autoSuggest",function(a,b,c){var d=this;d.rootId="category_1_container",d.categoriesMap=b.buildCategoriesMap({root:d.rootId}),c.setCategoryMaps(d.categoriesMap),a.suggestions={empty:!0},a.selectedCategories={},a.getSuggestions=function(b){a.suggestions=c.getSuggestions(b)},a.toggleSelection=function(b){var d=angular.element(b.target||b.srcElement).attr("id");a.selectedCategories=c.addSelectionAndParents(d,a),console.log(a.selectedCategories)},a.removeSelection=function(d,e){var f=b.buildCategoriesMap({root:d});a.selectedCategories=c.removeSelections(f,e,a),console.log(e)}}]),app.directive("superheroes",[function(){return{restrict:"E",replace:!0,templateUrl:"superheroes.html",controller:"AutoSuggestController"}}]),angular.module("myApp.filters",[]).filter("interpolate",["version",function(a){return function(b){return String(b).replace(/\%VERSION\%/gm,a)}}]),app.factory("categoriesMapBuilder",function(){return{getPreviousSibling:function(a){var b=a.previousSibling;return 1!==b.nodeType?this.getPreviousSibling(b):b},buildCategoriesMap:function(a){for(var b=document.getElementById(a.root),c=b.children,d=a.categoriesMap||{},e=a.count||0,f=a.containerIdentifier||"_container",g=a.currentPath||"/"+this.getPreviousSibling(b).getElementsByTagName("a")[0].innerHTML,h=0,i=c.length;i>h;h++){var j=c[h],k=j.getAttribute("id");if("div"===j.tagName.toLowerCase()&&k&&~k.indexOf(f)){var l=this.getPreviousSibling(j),m=l.getElementsByTagName("a")[0].innerHTML,n=k.match(/category_(\d+)/)[1],o=j.parentNode.getAttribute("id").match(/category_(\d+)/)[1];e++,d[n]={parentId:o,name:m,path:g},d=this.buildCategoriesMap({root:k,categoriesMap:d,count:e,currentPath:g+"/"+m})}}return d}}}),app.factory("autoSuggest",function(){return{setCategoryMaps:function(a){this.categoriesMap=a,this.selectedCategoriesMap={}},getSuggestions:function(a){console.log("query ",a),this.query=a;var b={empty:!0};if(this.query.length>2)for(var c in this.categoriesMap)if(this.categoriesMap.hasOwnProperty(c)){var d=this.categoriesMap[c].name;console.log(c),~d.toLowerCase().indexOf(this.query.toLowerCase())&&!this.selectedCategoriesMap.hasOwnProperty(c)&&(b=b.empty?{}:b,b[c]=this.categoriesMap[c])}return b},addSelectionAndParents:function(a,b){var c=this.categoriesMap[a],d=[a];d=this.getParentCategories(c,d);for(var e=d.length-1;e>=0;e--)this.selectedCategoriesMap=this.addSelection(d[e],b);return b.suggestions=this.getSuggestions(this.query),this.selectedCategoriesMap},getParentCategories:function(a,b){return this.categoriesMap.hasOwnProperty(a.parentId)&&(b.push(a.parentId),b=this.getParentCategories(this.categoriesMap[a.parentId],b)),b},addSelection:function(a){var b=this.categoriesMap[a];return b&&!this.selectedCategoriesMap.hasOwnProperty(a)&&(this.selectedCategoriesMap[a]=b),this.selectedCategoriesMap},removeSelections:function(a,b,c){this.removeSelection(b);for(var d in a)a.hasOwnProperty(d)&&this.removeSelection(d);return c.suggestions=this.getSuggestions(this.query),this.selectedCategoriesMap},removeSelection:function(a){this.selectedCategoriesMap.hasOwnProperty(a)&&delete this.selectedCategoriesMap[a]}}});